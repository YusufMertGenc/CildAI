<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CildAI â€“ Dijital Cilt Analiz AsistanÄ±</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="style.css" />
</head>

  <body>
    <div class="container">
      <div class="header">
        <img src="logoooo.jpg" alt="CildAI Logo" class="logo" />
        <h1>CildAI</h1>
        <p class="subtitle">
          Cilt saÄŸlÄ±ÄŸÄ±nÄ±z iÃ§in yapay zekÃ¢ destekli analiz asistanÄ±
        </p>
      </div>

      <section class="intro-box">
        <p>
          ğŸ“· Cilt problemini gÃ¶steren bir fotoÄŸraf yÃ¼kleyin veya Ã§ekin. AÃ§Ä±klama
          eklerseniz daha doÄŸru sonuÃ§lar alÄ±rsÄ±nÄ±z. Gemini modeli saniyeler
          iÃ§inde analiz eder.
        </p>
      </section>

      <form id="uploadForm" class="upload-section">
        <div class="upload-card">
          <h2>ğŸ”¬ Analize BaÅŸla</h2>
          <p>
            GÃ¶rsel yÃ¼kleyin, belirtmek istediÄŸiniz notlarÄ± girin ve analiz
            butonuna tÄ±klayÄ±n.
          </p>

          <div class="button-group">
            <label for="imageInput" class="action-button primary"
              >+ FotoÄŸraf SeÃ§</label
            >
            <input type="file" id="imageInput" accept="image/*" required hidden />

            <button type="button" id="start-camera" class="action-button primary">
              ğŸ“¸ FotoÄŸraf Ã‡ek
            </button>
          </div>

          <div id="camera" style="display: none">
            <video id="video" width="320" height="240" autoplay></video>
            <button type="button" id="snap" class="action-button secondary">
              FotoÄŸraf Ã‡ek
            </button>
          </div>

          <div id="photo-preview" style="display: none">
            <canvas id="snapshot" width="320" height="240"></canvas>
            <button type="button" id="remove-photo" class="action-button danger">
              âŒ FotoÄŸrafÄ± KaldÄ±r
            </button>
          </div>

          <textarea
            id="userNotes"
            placeholder="Varsa belirtmek istediÄŸiniz belirtiler veya notlar..."
            rows="4"
          ></textarea>

          <button type="submit" class="action-button primary">
            ğŸ” Analizi BaÅŸlat
          </button>
        </div>
      </form>
      <div style="text-align: center; margin-top: 1.5rem;">
  <button onclick="window.location.href='giriÅŸ.html'" style="padding: 0.7rem 1.5rem; background: #4A5568; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
    ğŸ  Ana Sayfaya DÃ¶n
  </button>
</div>


      <div id="result" class="result-box">Analiz sonuÃ§larÄ± burada gÃ¶rÃ¼necek...</div>

      <footer class="footer">
        <p>Â© 2025 CildAI | GeliÅŸtirici Bootcamp Projesi</p>
      </footer>
    </div>

    <script>
      // Kamera baÅŸlatma ve fotoÄŸraf Ã§ekme iÅŸlemleri
      const startCameraButton = document.getElementById("start-camera");
      const cameraDiv = document.getElementById("camera");
      const videoElement = document.getElementById("video");
      const snapButton = document.getElementById("snap");
      const snapshotCanvas = document.getElementById("snapshot");
      const context = snapshotCanvas.getContext("2d");
      const photoPreview = document.getElementById("photo-preview");
      const removePhotoButton = document.getElementById("remove-photo");
      const imageInput = document.getElementById("imageInput"); // Added for file input handling
      const customFileUploadLabel = document.querySelector(".custom-file-upload");
      const buttonGroup = document.querySelector(".button-group");

      let stream = null; // To store the camera stream

      startCameraButton.addEventListener("click", function () {
        cameraDiv.style.display = "flex"; // Use flex for better centering of video
        photoPreview.style.display = "none"; // Hide photo preview if visible
        imageInput.value = null; // Clear any selected file
        startCamera(); // KamerayÄ± baÅŸlat
        startCameraButton.style.display = "none"; // FotoÄŸraf Ã§ekme butonunu gizle
        customFileUploadLabel.style.display = "none"; // Hide file upload label
      });

      // KamerayÄ± baÅŸlatma
      function startCamera() {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
          navigator.mediaDevices
            .getUserMedia({ video: true })
            .then(function (s) {
              stream = s; // Store stream to stop it later
              videoElement.srcObject = stream;
              videoElement.play(); // Start playing the video stream
            })
            .catch(function (error) {
              console.error("Kamera baÅŸlatÄ±lamadÄ±: ", error);
              alert(
                "Kamera eriÅŸimi reddedildi veya cihaz bulunamadÄ±. LÃ¼tfen izinleri kontrol edin."
              );
              resetCameraAndFileInput();
            });
        } else {
          alert("TarayÄ±cÄ±nÄ±z kamera desteÄŸi sunmuyor.");
          resetCameraAndFileInput();
        }
      }

      // Stop camera stream
      function stopCamera() {
        if (stream) {
          stream.getTracks().forEach((track) => track.stop());
          videoElement.srcObject = null;
          stream = null;
        }
      }

      // FotoÄŸraf Ã§ekme iÅŸlemi
      snapButton.addEventListener("click", function () {
        context.drawImage(videoElement, 0, 0, snapshotCanvas.width, snapshotCanvas.height);
        snapshotCanvas.style.display = "block"; // FotoÄŸrafÄ± gÃ¶ster
        photoPreview.style.display = "flex"; // FotoÄŸraf Ã¶nizlemesini gÃ¶ster
        cameraDiv.style.display = "none"; // KamerayÄ± gizle
        stopCamera(); // Stop camera stream after snapping
      });

      // FotoÄŸrafÄ± kaldÄ±rma iÅŸlemi
      removePhotoButton.addEventListener("click", function () {
        snapshotCanvas.style.display = "none";
        photoPreview.style.display = "none";
        resetCameraAndFileInput();
      });

      // Reset camera and file input buttons
      function resetCameraAndFileInput() {
        stopCamera(); // Ensure camera is stopped
        startCameraButton.style.display = "inline-flex"; // Show camera button
        customFileUploadLabel.style.display = "inline-flex"; // Show file upload label
        imageInput.value = null; // Clear selected file
        cameraDiv.style.display = "none"; // Hide camera div
      }

      // FotoÄŸraf seÃ§me iÅŸlemi (from file)
      imageInput.addEventListener("change", function (event) {
        const file = event.target.files[0];
        if (file) {
          stopCamera(); // Stop camera if active
          cameraDiv.style.display = "none"; // Hide camera div
          startCameraButton.style.display = "none"; // Hide camera button

          const reader = new FileReader();
          reader.onload = function (e) {
            const img = new Image();
            img.onload = function () {
              context.clearRect(0, 0, snapshotCanvas.width, snapshotCanvas.height);
              // Calculate aspect ratio to fit the image while maintaining proportions
              const aspectRatio = img.width / img.height;
              let drawWidth = snapshotCanvas.width;
              let drawHeight = snapshotCanvas.height;

              if (snapshotCanvas.width / snapshotCanvas.height > aspectRatio) {
                  drawWidth = snapshotCanvas.height * aspectRatio;
              } else {
                  drawHeight = snapshotCanvas.width / aspectRatio;
              }
              const offsetX = (snapshotCanvas.width - drawWidth) / 2;
              const offsetY = (snapshotCanvas.height - drawHeight) / 2;

              context.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);
              snapshotCanvas.style.display = "block";
              photoPreview.style.display = "flex";
            };
            img.src = e.target.result;
          };
          reader.readAsDataURL(file);
        } else {
          // If user cancels file selection, reset everything
          resetCameraAndFileInput();
        }
      });

      // Analiz baÅŸlat butonuna tÄ±klanmasÄ±
      const uploadForm = document.getElementById("uploadForm");
      const resultBox = document.getElementById("result");

      uploadForm.addEventListener("submit", function (e) {
        e.preventDefault(); // Formun sayfayÄ± yeniden yÃ¼klemesini engelle

        const userNotes = document.getElementById("userNotes").value;
        let imageData = null;

        // Check if an image is from camera or file input
        if (snapshotCanvas.style.display === "block") {
          imageData = snapshotCanvas.toDataURL("image/png"); // Get image data from canvas
        } else {
          alert("LÃ¼tfen analiz iÃ§in bir fotoÄŸraf seÃ§in veya Ã§ekin.");
          return;
        }

        if (!imageData || imageData === "data:,") { // "data:," indicates empty canvas
            alert("Analiz iÃ§in bir fotoÄŸraf gereklidir.");
            return;
        }

        resultBox.innerHTML =
          '<p style="color: var(--text-medium); font-style: normal;">Analiz ediliyor... LÃ¼tfen bekleyin.</p>';
        resultBox.style.color = "var(--text-medium)";
        resultBox.style.fontStyle = "normal";

        // Simulate API call (replace with actual API call)
        console.log("FotoÄŸraf verisi (Base64):", imageData.substring(0, 50) + "..."); // Log first 50 chars
        console.log("KullanÄ±cÄ± NotlarÄ±:", userNotes);

        setTimeout(() => {
          const simulatedResult = `
                <h3>Analiz Sonucu: Kuru Cilt EÄŸilimi</h3>
                <p>Cildinizde hafif kuruluk, bazÄ± bÃ¶lgelerde gerginlik ve ince Ã§izgiler gÃ¶zlemlenmektedir. Mevcut notlarÄ±nÄ±zda belirttiÄŸiniz kaÅŸÄ±ntÄ± hissi de kuruluÄŸa iÅŸaret etmektedir.</p>
                <h4>Ã–neriler:</h4>
                <ul>
                    <li><strong>YoÄŸun Nemlendirme:</strong> Hyaluronik asit ve seramid iÃ§eren nemlendiricileri gÃ¼nde iki kez uygulayÄ±n.</li>
                    <li><strong>Nazik Temizlik:</strong> SÃ¼lfat iÃ§ermeyen, nazik temizleyiciler kullanÄ±n.</li>
                    <li><strong>Bol Su TÃ¼ketimi:</strong> GÃ¼n iÃ§inde yeterli miktarda su iÃ§meye Ã¶zen gÃ¶sterin.</li>
                    <li><strong>GÃ¼neÅŸ KorumasÄ±:</strong> Her mevsim yÃ¼ksek faktÃ¶rlÃ¼ gÃ¼neÅŸ kremi kullanÄ±n.</li>
                    <li><strong>Uzman GÃ¶rÃ¼ÅŸÃ¼:</strong> Belirtiler devam ederse bir dermatoloÄŸa danÄ±ÅŸmanÄ±z Ã¶nerilir.</li>
                </ul>
            `;
          resultBox.innerHTML = `
  ${simulatedResult}
  <div style="text-align: center; margin-top: 2rem;">
    <button onclick="window.location.reload()" style="padding: 0.7rem 1.5rem; background: #b23a48; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
      ğŸ” Yeni Analiz Yap
    </button>
    
  </div>
`;

          resultBox.style.color = "var(--text-dark)";
          resultBox.style.fontStyle = "normal";
        }, 3000); // Simulate 3-second analysis time
      });
    </script>
  </body>
</html>